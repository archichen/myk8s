# apps/my-database/fleet.yaml
# 目标：在不同环境的集群中，部署不同规格的 PostgreSQL 数据库实例

defaultNamespace: apps

# 这不是一个 Helm Chart，而是一组普通的 K8s YAML 文件
# 我们将 YAML 内容直接内联在这里，也可以通过 `kustomize` 或 `helm` 的方式
# 这里我们使用最简单的 `yaml` 定义
# 注意：这个资源 (kind: Cluster) 是由 CloudNativePG Operator 提供的 CRD
yaml:
  apiVersion: postgresql.cnpg.io/v1
  kind: Cluster
  metadata:
    name: postgres-db
  spec:
    instances: 3
    # 默认规格
    storage:
      size: "20Gi" # 默认是 20Gi

# # targetCustomizations 是实现差异化配置的关键
# targetCustomizations:
#   # 自定义配置的名称，可以任意取
# - name: production-override
#   # 选择器：应用到哪些集群？
#   # 这里我们选择所有包含 "env: production" 标签的集群
#   clusterSelector:
#     matchLabels:
#       env: production
  
#   # 对选中的集群，应用下面的覆盖配置
#   # 这里我们使用 YAML Patch 的方式来覆盖
#   yaml:
#     # patches 字段允许你对上面的基础 YAML 进行修改
#     patches:
#     - op: replace # 操作类型：替换
#       path: "/spec/storage/size" # 要修改的字段路径
#       value: "50Gi" # 新的值